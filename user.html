<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>User Task Generator</title>
<style>
body {
  background: url('min.jpg') no-repeat center center fixed;
  background-size: cover;
  font-family: Arial, sans-serif;
  color: #fff;
  text-align: center;
  padding: 20px;
}
h1 {text-shadow:1px 1px 3px #000;}
textarea {
  width: 90%;
  height: 300px;
  margin-top: 10px;
  padding: 10px;
  border-radius: 8px;
  border: none;
  resize: none;
}
button {
  padding: 10px 20px;
  margin: 5px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
}
.generate {background-color: #28a745;color:#fff;}
.copy {background-color:#007bff;color:#fff;}

/* login overlay */
#loginOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.85);
  display:flex;justify-content:center;align-items:center;
  z-index:9999;color:#fff;font-family:Arial;
}
#loginOverlay div{
  background:#222;padding:30px;border-radius:8px;
  box-shadow:0 0 10px #000;text-align:center;
}
#loginOverlay input{
  padding:8px;border-radius:4px;border:none;margin:10px;width:200px;
}
#loginOverlay button{
  padding:8px 15px;border:none;border-radius:5px;
  background:#28a745;color:#fff;cursor:pointer;
}
#loginError{color:red;display:none;margin-top:10px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginOverlay">
  <div>
    <h2>User Login</h2>
    <input type="password" id="loginPass" placeholder="Enter password"><br>
    <button onclick="checkLogin()">Login</button>
    <p id="loginError">Wrong password</p>
  </div>
</div>

<!-- CONTENT -->
<div id="protectedContent" style="display:none;">
  <h1>Today's Tasks</h1>
  <button class="generate" onclick="generateTasks()">Generate</button>
  <textarea id="taskBox" placeholder="Your tasks will appear here..."></textarea><br>
  <button class="copy" onclick="copyTask()">Copy to Clipboard</button>
</div>

<script>
const userPassword="User123"; // CHANGE THIS

// ---------- LOGIN ----------
function checkLogin(){
  const val=document.getElementById('loginPass').value;
  if(val===userPassword){
    sessionStorage.setItem('authOK_user','yes');
    document.getElementById('loginOverlay').style.display='none';
    document.getElementById('protectedContent').style.display='block';
  } else {
    document.getElementById('loginError').style.display='block';
  }
}
window.onload=function(){
  if(sessionStorage.getItem('authOK_user')==='yes'){
    document.getElementById('loginOverlay').style.display='none';
    document.getElementById('protectedContent').style.display='block';
  }
};

// ---------- TASK GENERATION ----------
function generateTasks() {
  const today = new Date();
  const todayMidnight = new Date(today.getFullYear(), today.getMonth(), today.getDate());
  let tasks = [];
  const dayDiff = (dueDate) => Math.floor((new Date(dueDate.getFullYear(),dueDate.getMonth(),dueDate.getDate())-todayMidnight)/(1000*60*60*24));

  // TIME-BOUND TASKS
  let timeTasks = JSON.parse(localStorage.getItem('timeTasks')) || [];
  timeTasks.forEach(t => {
    const diff = dayDiff(new Date(t.date));
    if(diff>=0 && diff<=2){
      const label = diff===0 ? "(Due today)" : diff===1 ? "(Due tomorrow)" : "(Due in 2 days)";
      tasks.push(`${t.task} ${label}`);
    }
  });

  // REPETITIVE TASKS
  let repTasks = JSON.parse(localStorage.getItem('repTasks')) || [];
  repTasks.forEach(t=>{
    // Monthly tasks
    if(t.repDate){
      for(let advance=0;advance<=2;advance++){
        const checkDate = new Date(today.getFullYear(),today.getMonth(),today.getDate()+advance);
        if(checkDate.getDate()===parseInt(t.repDate)){
          const label = advance===0 ? "(Monthly today)" : `(Monthly in ${advance} day${advance>1?'s':''})`;
          tasks.push(`${t.task} ${label}`);
        }
      }
    }
    // Weekly tasks (fixed)
    if(t.weekly && t.weekday){
      const dayNames=["sun","mon","tue","wed","thu","fri","sat"];
      const wantedDay = dayNames.indexOf(t.weekday.toLowerCase().slice(0,3));
      for(let advance=0;advance<=7;advance++){
        const checkDate = new Date(today.getFullYear(),today.getMonth(),today.getDate()+advance);
        if(checkDate.getDay()===wantedDay){
          if(advance<=2){ // show if today or within 2-day advance
            const label = advance===0 ? "(Due today)" : `(In ${advance} day${advance>1?'s':''})`;
            tasks.push(`${t.task} ${label}`);
          }
          break; // stop after first upcoming occurrence
        }
      }
    }
  });

  // BIRTHDAYS / ANNIVERSARIES
  let bTasks = JSON.parse(localStorage.getItem('bdayTasks')) || [];
  bTasks.forEach(t=>{
    const due = new Date(today.getFullYear(), new Date(t.date).getMonth(), new Date(t.date).getDate());
    const diff = dayDiff(due);
    if(diff>=0 && diff<=2){
      const label = diff===0 ? "today!" : diff===1 ? "tomorrow!" : `in ${diff} days!`;
      tasks.push(`ðŸŽ‰ ${t.name} ${label}`);
    }
  });

  // EVERYDAY TASKS
  let eTasks = JSON.parse(localStorage.getItem('everydayTasks')) || [];
  eTasks.forEach(t=>tasks.push(`${t.task} (Everyday)`));

  document.getElementById('taskBox').value = tasks.length ? tasks.join("\n") : "No tasks!";
}

// COPY TO CLIPBOARD
function copyTask(){
  const t=document.getElementById('taskBox');
  t.select();
  t.setSelectionRange(0,99999);
  document.execCommand('copy');
  alert('Tasks copied!');
}
</script>
</body>
</html>
